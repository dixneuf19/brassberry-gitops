source_up

# used for k0sctl apply which does not handle ssh known hosts correctly
export SSH_KNOWN_HOSTS=/dev/null

export BIN_DIR="$HOME/.rd/bin"

# Scaleway credentials (for TF S3 backend + provider)
export SCW_ACCESS_KEY=$(scw config get access-key)
export SCW_SECRET_KEY=$(scw config get secret-key)
export SCW_DEFAULT_PROJECT_ID=$(scw config get default-project-id)
export SCW_DEFAULT_ORGANIZATION_ID=$(scw config get default-organization-id)
export AWS_ACCESS_KEY_ID=$SCW_ACCESS_KEY
export AWS_SECRET_ACCESS_KEY=$SCW_SECRET_KEY

# Helper: read a single-value secret from Scaleway Secret Manager
_scw_secret() {
  scw secret version access-by-path secret-path="$1" secret-name="$2" --output json | jq -r '.data' | base64 -d
}

# TF variables from Scaleway Secret Manager (terraform layer secrets only)
export TF_VAR_proxmox_api_token=$(_scw_secret /terraform/ proxmox-api-token)
export TF_VAR_ssh_public_key=$(_scw_secret /terraform/ ssh-public-key)
export TF_VAR_gandi_pat=$(_scw_secret /terraform/ gandi-pat)
